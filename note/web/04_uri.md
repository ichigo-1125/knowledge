# URI


## 目次

1. [URIの仕様](#uriの仕様)
	1. [URIの役割](#uriの役割)
	1. [URIの構文](#uriの構文)
	1. [ベースURI](#ベースuri)
	1. [URIと文字](#uriと文字)
	1. [URIスキーム](#uriスキーム)
	1. [URIとURLとURN](#uriとurlとurn)
1. [URIの設計](#uriの設計)
	1. [クールURI](#クールuri)
	1. [URIを変わりにくくするためには](#uriを変わりにくくするためには)
	1. [リダイレクト](#リダイレクト)
	1. [URI設計のテクニック](#uri設計のテクニック)
	1. [URIの不透明性](#uriの不透明性)


## URIの仕様

### URIの役割

**URI**（Uniform Resource Identifier）は、**統一リソース識別子**と呼ばれ、Web上に存在するすべてのリソースを一意に示すことができる。

### URIの構文

```
[URIの例]
http://blog.example.jp/entries/1

URIスキーム    : http
ホスト名       : blog.example.jp
パス           : /entries/1
```

**URIスキーム**（URI Scheme）は、そのURIが利用するプロトコルを示すのが一般的である。

**ホスト名**は、**DNS**（Domainn Name System）で名前解決できるドメイン名、もしくは**IPアドレス**であり、インターネット上で必ず一意に定まる。

ホスト名の後には階層を表すパスが続く。

```
[複雑なURIの例]
http://tanaka:pass@blog.example.jp:8000/search?q=test&debug=true#n10

URIスキーム       : http
ユーザ情報        : tanaka:pass
ホスト名          : blog.example.jp
ポート番号        : 8000
パス              : /search
クエリパラメータ  : q=test&debug=true
URIフラグメント   : #n10
```

この例では、URIスキームの次にユーザ名とパスワードからなるユーザ情報がくる。ユーザ情報とホスト名の区切り文字には、 `@` が使われる。

ホスト名の後ろには、TCPで利用されるポート番号が示されている。明示しなかった場合のHTTPのデフォルト値は80番となる。

また、 `?` 以降に続いているのは、**クエリパラメータ**（Query Parameter）または**クエリ文字列**（Query String）と呼ばれるクエリである。

最後の `#` で始まる部分は**URIフラグメント**（URI Fragment）といい、その前までの文字列で表現するURIが指し示すリソースの内部の、さらに細かい部分を特定するときに使用する。

### ベースURI

URIにはOSのファイルシステムと同様に、**絶対URI**と**相対URI**がある。相対URIの場合には、URIスキームやホスト名を省いてパスだけで表現する。

相対URIを使用する場合には、その起点となる**ベースURI**（Base URI、基底URI）が必要となる。

### URIと文字

URIのパスには、**ASCII文字**（American Standard Code for Information）が利用できる。日本語などのASCII以外の文字をURIに使いたい場合は、**%エンコーディング**（%-Encoding）という方式を用いて文字をエンコードする。

### URIスキーム

URIスキームの公式な一覧は**IANA**（Internet Assigned Numbers Authority）にある。最初は、HTTPに対応したhttpスキームが誕生し、その後は様々なプロトコルに対応したスキームが登録されていった。

### URIとURLとURN

URIは**URL**（Uniform Resource Locator）と**URN**（Uniform Resource Name）を総称する名前である。基本的にはURIとURLはほぼ同様のものと考えても問題ない。

URNは、ドメイン名とは独立してリソースに恒久的なIDを振るための仕様である。たとえば、書籍には**ISBN**という世界的に統一したIDを持っている。

```
urn:isbn:9784774142043
```


## URIの設計

### クールURI

良いURIやきれいなURIのことを**クールURI**（Cool URI）と呼ぶ。これは、Berners-Leeが1998年に発表した「Cool URIs don't change」というWebページが発祥となっている。Berners-Leeは、「URIは変わらないべきである。変わらないURIこそが最上のURIである」と主張した。

### URIを変わりにくくするためには

変わりにくいURIを設計するうえでのポイントは以下の通り。

- プログラミング言語に依存した拡張子を利用しない（.pl、.rb、.do、.jspなど）
- 実装依存のパス名を利用しない（cgi-bin、servletなど）
- メソッド名やセッションIDを含めない
- URIはリソースを表現する名詞にする
- URIをシンプルにする
- 覚えやすく、開発者ではない普通の人にも使いやすいURIにする

### リダイレクト

**リダイレクト**（Redirect）とは、古いURIを新しいURIに転送するHTTPの仕組みのこと。URIを変更したいときには、できる限りリダイレクトするようにする。

### URI設計のテクニック

HTTPには**コンテントネゴシエーション**（Content Negotiation）という機能があり、日本語版のOSを利用しているユーザには日本語を、英語版のOSを利用しているユーザには英語を返すことができる。

コンテントネゴシエーションはクライアントの言語設定に従って自動的に適したリソースの表現を返すことができる。しかし、日本語OSの利用者に対しても英語のリソースを簡単に提供できるように、リソースの言語を明示的に指定した次のようなURIを使うことがある。

```
[日本語版]
http://example.jp/2022/01/01/press.ja
http://example.jp/ja/2022/01/01/press

[英語版]
http://example.jp/2022/01/01/press.en
http://example.jp/en/2022/01/01/press
```

また、言語だけではなくリソースのフォーマット（HTMlやJSON、PDFなど）を拡張子によって切り替えさせる手法もある。

```
http://example.jp/diary/2022/01/01
```

上記の例のように、URIのパスに対して階層構造を持つパラメータを持たせることはよくある。一方で、階層構造を持たない複数パラメータの組み合わせで表現するリソースには、**マトリクスURI**（Matrix URI）を使う。マトリクスURIでは、複数の軸のパラメータをそれぞれセミコロンかカンマによって区切る。

```
[マトリクスURI]
http://example.jp/map/lat=35.705471;lng=139.751898
http://example.jp/map/35.705471,139.751898
```

### URIの不透明性

URIをクライアント側で組み立てたり、拡張子からリソースの内容を推測したりできないことを、URIがクライアントにとって**不透明**であるという。

クライアント側で内部構造を推測してURIを組み立てられないように、URIが不透明であることを心掛けなければならない。
