# アプリケーションサービス


## 目次

1. [SQS](#sqs)
	1. [StandardキューとFIFOキュー](#standardキューとfifoキュー)
	1. [ロングポーリングとショートポーリング](#ロングポーリングとショートポーリング)
	1. [可視性タイムアウト](#可視性タイムアウト)
	1. [遅延キューとメッセージタイマー](#遅延キューとメッセージタイマー)
	1. [デッドレターキュー](#デッドレターキュー)
	1. [メッセージサイズ](#メッセージサイズ)
1. [SWFとStep Functions](#swfとstep-functions)
	1. [AWSのワークフローサービス](#awsのワークフローサービス)
1. [SNS](#sns)
	1. [トピックと購読](#トピックと購読)
1. [SES](#ses)


## SQS

**SQS**（Amazon Simple Queue Service）は、AWSが提供するフルマネージドなメッセージキューイングサービス。SQSの機能としては、キューの管理とメッセージの管理の2つがある。

**キュー**とは、メッセージを管理するための入れ物のようなもので、エンドポイントとなるURLを介して利用する。

### StandardキューとFIFOキュー

**Standardキュー**では、メッセージの配信順序は保証されておらず、取得のタイミングによっては同一のメッセージが2回配信される可能性がある。そのため、システム側はべき等性を保証する必要がある。

**FIFOキュー**は配信順序が保証されており、同一メッセージの二重取得の問題も解消されている。Standardキューに比べて1秒当たりの処理件数は劣っている。

### ロングポーリングとショートポーリング

キューのメッセージ取得方法としては、**ロングポーリング**と**ショートポーリング**がある。ショートポーリングでは、リクエストを受け取るとメッセージの有無にかかわらず即時レスポンスを返す。ロングポーリングでは、メッセージがない場合には設定されたタイムアウトぎりぎりまでレスポンスを返さない。

ロングポーリングを利用することで空のレスポンスを減らし、リクエストの回数も減らすことができるため、コストが削減につながる。

### 可視性タイムアウト

メッセージは受信しただけでは削除されず、メッセージの取得中にほかのクライアントが同じメッセージを取得してしまう可能性がある。**可視性タイムアウト**（Visibility Timeout）を用いると、処理中のメッセージを他のコンシューマから見えないようにすることができる。これにより、同じメッセージの受信を防止する。

### 遅延キューとメッセージタイマー

**遅延キュー**は、キューに送られたメッセージを一定時間見えなくする機能。

**メッセージタイマー**は、個別のメッセージに対して一定時間見えなくする機能。

### デッドレターキュー

**デッドレターキュー**（Dead Letter Queue）は、処理できないメッセージを別のキューに移動する機能。指定された回数処理が失敗したメッセージを通常のキューから除外して、デッドレターキューに移動する。

### メッセージサイズ

キューに格納できるサイズは最大256KBで、画像情報などを扱うには足りない。大きなサイズのデータはS3やDynamoDBに格納し、そこへのパスやキーといったポインタ情報をキューに保持して対応できる。


## SWFとStep Functions

### AWSのワークフローサービス

複数の処理があった場合の一連の処理の流れのことを**ワークフロー**と呼ぶ。

AWSにはワークフローサービスとして、**SWF**（Amazon Simple Workflow）と**Amazon Step Functions**がある。Step Functionsはワークフローを可視化できる機能があり、容易にワークフローを編集することができる。


## SNS

**SNS**（Amazon Simple Notification Service）はユーザにシステムの状態を知らせる際に重要な役割を果たす、プッシュ型の通知サービス。SMS、email、HTTP/HTTPS、SQSなど様々なプロトコルに対応している。

SNSは、AWSのサービスで発生したイベントに関する通知も扱うことができる。

### トピックと購読

SNSは、**トピック**という単位で情報を管理する。トピックの利用者としては、通知する人（**Publisher**）と通知される人（**Subscriber**）が存在する。Subscriberが利用するトピックを登録することを、**購読**と呼ぶ。


## SES

**SES**（Amazon Simple Email Service）は、Eメール送信のサービス。SMTPプロトコルを利用する。Eメールを送信するだけでなく、受信したEメールをS3に保存することもできる。

SESは、送信時にウイルスやマルウェアを検出してブロックする機能、送信の成功数や拒否された数を統計的に処理し、配信不能や苦情を管理する機能、**SPF**（Sender Policy Framework）や**DKIM**（DomainKyes Identified Mail）といった認証機能などを備えている。
