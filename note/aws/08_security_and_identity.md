# セキュリティとアイデンティティ


## 目次

1. [KMSとCloudHSM](#kmsとcloudhsm)
	1. [KMSの機能](#kmsの機能)
	1. [マスタキーとデータキー](#マスタキーとデータキー)
	1. [クライアントサイド暗号化とサーバサイド暗号化](#クライアントサイド暗号化とサーバサイド暗号化)
1. [ACM](#acm)
	1. [証明書の役割と実体](#証明書の役割と実体)
	1. [ACMについて](#acmについて)


## KMSとCloudHSM

機密性の高いデータを運用するには、暗号化の施策が必要となる。**AWS KMS**（Key Management Service）や**AWS CloudHSM**は、暗号化鍵の作成と管理のためのサービスである。

**KMS**は、AWSが管理するマネージドサービスで、多くの場合はこちらが用いられる。**CloudHSM**は、[VPC](./03_networking_and_content_delivery.md#vpc)内で専有のハードウェアを利用して鍵を管理するサービスで、大規模なシステムに用いる。

### KMSの機能

KMSの主な機能は鍵管理機能とデータ暗号化機能で、暗号化機能としては次のようなAPIがある。

**Encrypt**はデータを暗号化するためのAPIで、4KBまでの平文データに対応している。

**Decrypt**はデータを復号するためのAPI。

**GenerateDataKey**はユーザがデータの暗号化に利用するためのカスタマーデータキーを生成する。

### マスタキーとデータキー

KMSで管理する鍵には、**マスタキー**（**Customer Master Key**（CMK））と**データキー**（**Customer Data Key**（CDK））がある。CMKはデータキーを暗号化するための鍵で、CDKはデータを暗号化するための鍵。このようにデータを暗号化するための鍵を暗号化するような2層構造の方式を、**エンベロープ暗号化**と呼ぶ。

### クライアントサイド暗号化とサーバサイド暗号化

**クライアントサイド暗号化**はユーザ側の処理で暗号化する方式。AWSが提供するSDKを利用して行うことが多い。

**サーバサイド暗号化**はAWS側の処理で暗号化する方式。AWSのサービスは、基本的にはサーバサイド暗号化が用いられている。


## ACM

### 証明書の役割と実体

インターネットを介して情報をやり取りする場合は、通信の暗号化が必須となってきている。サーバとのやり取りの暗号化を行い、さらにそのサーバの信頼性を確認するために、**サーバ証明書**が利用される。その際に利用されるプロトコルが、**SSL/TLS**（Secure Socket Layer / Transport Layer Security）であるため、サーバ証明書は**SSL証明書**と呼ばれることも多い（SSL/TLSを利用したHTTP通信をHTTPS、FTP通信をSFTPのように呼ぶ）。

証明書を利用すると、経路間の通信の安全性を確保できるだけでなく、通信している相手が誰であるかの証明もできる。本人であることや自分が所属している組織であることを証明するには、信頼性が高い第三者が必要となる。このためSSL証明書は、**認証局**（Certification Authority、**CA**）という、証明書を管理するための機関により発行されている。

**自己証明書**は自分で認証局を立てて証明書を発行する方式で、信頼性は担保できない。

**ドメイン証明**（DV）はドメインの所有のみを認証する方式。

**組織認証**（OV）は組織情報の審査を経てから認証する方式。

**拡張認証**（EV）はOVより厳格な審査で認証する方式。

### ACMについて

**ACM**（AWS Certificate Manager）は、AWS自身が認証局となってDV証明書を発行するサービス。RSAとSHA（暗号化方式）のSSL/TLSサーバ証明書の作成・管理を行うことができる。証明書の有効期限は13か月で、自動で更新するように設定することができる。
